# 🚀 카페24 Node.js 호스팅 배포 가이드

DOTELINE 웹사이트를 카페24 자이언트 호스팅에 Git으로 배포하는 가이드입니다.

## 📋 목차
1. [로컬 프로젝트 환경 설정](#1단계-로컬-프로젝트-환경-설정)
2. [카페24 관리자 페이지 설정](#2단계-카페24-관리자-페이지-설정)
3. [Git 원격 저장소 연결 및 배포](#3단계-git-원격-저장소-연결-및-배포)
4. [환경 변수 설정 (WinSCP)](#4단계-winscp를-이용한-환경-변수-설정)
5. [앱 실행 및 업데이트](#5단계-앱-최종-실행-및-업데이트)
6. [문제 해결](#-문제-해결-troubleshooting)

---

## 1단계: 로컬 프로젝트 환경 설정 (내 컴퓨터)

배포 전, 소스 코드가 카페24 환경에 맞는지 확인합니다.

### ✅ 이미 완료된 설정

이 프로젝트는 이미 카페24 배포를 위한 설정이 완료되어 있습니다:

- ✅ **메인 실행 파일**: `web.js` (카페24 필수 파일명)
- ✅ **포트 설정**: `process.env.PORT || 8001` (카페24 기본 포트)
- ✅ **.gitignore**: 필요한 파일만 포함하도록 설정됨

### 📝 로컬에서 테스트

배포하기 전에 로컬에서 정상 작동을 확인하세요:

```bash
# 의존성 설치
npm install

# 개발 모드로 실행
npm run dev

# 브라우저에서 테스트
# http://localhost:8001
```

---

## 2단계: 카페24 관리자 페이지 설정

### 1. 앱 생성

1. 카페24 관리자 페이지 로그인
2. **[나의 서비스 관리]** > **[앱 생성/관리]** 메뉴로 이동
3. **Node.js 앱 생성** 버튼 클릭
4. 앱 이름 입력 (예: `doteline-web`)

### 2. SSH 공개키 등록

Git 배포를 위해서는 SSH 키가 필요합니다.

#### Windows에서 SSH 키 생성

```bash
# Git Bash 또는 PowerShell에서 실행
ssh-keygen -t rsa -b 4096 -C "your_email@example.com"

# Enter를 눌러 기본 경로로 저장
# 비밀번호 설정 (선택사항)

# 공개키 내용 확인 (복사)
cat ~/.ssh/id_rsa.pub
```

#### 카페24에 공개키 등록

1. **[나의 서비스 관리]** > **[Public Key 관리]** 메뉴로 이동
2. **[Public Key 등록]** 버튼 클릭
3. 위에서 복사한 `id_rsa.pub` 내용을 붙여넣기
4. 저장

### 3. 앱에 키 할당 (⚠️ 중요!)

1. **[앱 생성/관리]** 메뉴에서 생성한 앱 선택
2. 등록한 Public Key 옆의 **[할당]** 버튼 클릭
   - ⚠️ **이 단계를 빠뜨리면 Permission Denied 에러가 발생합니다!**

### 4. 저장소 주소 복사

앱 관리 화면에서 Git 저장소 주소를 확인하고 복사합니다:

```
형식: 아이디@도메인:앱이름
예시: userid@p12345.cafe24.com:doteline-web
```

---

## 3단계: Git 원격 저장소 연결 및 배포

프로젝트 폴더에서 터미널을 열고 아래 명령어를 차례대로 실행합니다.

### 최초 배포

```bash
# 1. Git 초기화 (아직 안 했다면)
git init

# 2. 모든 파일 스테이징
git add .

# 3. 첫 커밋 생성
git commit -m "First Deploy"

# 4. 카페24 서버를 원격 저장소로 추가
# [카페24_저장소_주소]를 복사한 주소로 변경하세요
git remote add cafe24 [카페24_저장소_주소]

# 예시:
# git remote add cafe24 userid@p12345.cafe24.com:doteline-web

# 5. 서버로 코드 전송
git push cafe24 master
```

### 배포 과정에서 확인할 메시지

```bash
# 정상적으로 배포되면 다음과 같은 메시지가 표시됩니다:
Remote: npm install...
Remote: Building...
To userid@p12345.cafe24.com:doteline-web
 * [new branch]      master -> master
```

---

## 4단계: WinSCP를 이용한 환경 변수 설정

`.env` 파일은 민감한 정보를 포함하므로 Git에 포함되지 않습니다.
WinSCP를 통해 수동으로 한 번만 업로드하면 됩니다.

### 1. WinSCP 설치 및 접속

1. **WinSCP 다운로드**: https://winscp.net/
2. WinSCP 실행 후 새 세션 생성:
   - **파일 프로토콜**: SFTP
   - **호스트 이름**: 카페24 서버 주소 (예: `p12345.cafe24.com`)
   - **포트 번호**: 22
   - **사용자 이름**: 카페24 아이디
   - **비밀번호**: 카페24 비밀번호
3. **로그인** 클릭

### 2. .env 파일 생성 및 업로드

#### 로컬에서 .env 파일 생성

프로젝트 루트 폴더에 `.env` 파일을 생성하고 아래 내용을 입력:

```env
PORT=8001
NODE_ENV=production
DOMAIN=doteline.co.kr
```

#### WinSCP로 업로드

1. WinSCP 왼쪽(로컬)에서 `.env` 파일 선택
2. 오른쪽(서버)의 앱 루트 폴더로 드래그하여 업로드
3. 업로드 완료 확인

---

## 5단계: 앱 최종 실행 및 업데이트

### 앱 시작

1. 카페24 관리자 페이지로 이동
2. **[나의 서비스 관리]** > **[앱 생성/관리]**
3. 배포한 앱 선택
4. **[실행]** 버튼 클릭
5. 상태가 **실행 중(Running)**으로 변경되는지 확인

### 접속 테스트

브라우저에서 할당받은 도메인으로 접속:
```
http://your-domain.cafe24.com
또는
https://doteline.co.kr (도메인 연결 후)
```

### 코드 수정 후 재배포

코드를 수정한 후 다음 명령어로 재배포:

```bash
# 1. 수정 사항 커밋
git add .
git commit -m "수정 내용 설명"

# 2. 카페24 서버로 푸시
git push cafe24 master

# 3. 카페24 관리자 페이지에서
# [중지] → [실행] 버튼 클릭하여 재시작
```

---

## 💡 문제 해결 (Troubleshooting)

### Permission Denied 에러

**증상**: `git push` 시 Permission denied 에러 발생

**해결 방법**:
1. 카페24 관리자 페이지에서 SSH Key를 **[할당]** 했는지 확인
2. 공개키가 올바르게 등록되었는지 확인
3. SSH 키 경로 확인: `~/.ssh/id_rsa` 파일이 존재하는지 확인

### 403/502 에러

**증상**: 웹사이트 접속 시 403 또는 502 에러 발생

**확인 사항**:
1. **메인 파일명이 `web.js`인지 확인**
   ```bash
   # 프로젝트 루트에 web.js가 있어야 함
   ls web.js
   ```

2. **포트가 8001인지 확인**
   - `server/server.js:15` - `PORT = process.env.PORT || 8001`
   - `.env` 파일에 `PORT=8001` 설정

3. **카페24 관리자 페이지에서 앱 상태 확인**
   - 상태가 "실행 중"인지 확인

### command not found (Node 명령어를 쓸 수 없음)

**증상**: SSH로 접속 후 `node -v` 입력 시 `command not found` 에러

**설명**:
- 카페24 Node.js 호스팅은 일반 VPS와 다릅니다
- 앱마다 독립된 Node.js 환경이 구성되어 있습니다
- 사용자가 직접 `node` 명령어를 실행할 수 없는 것이 정상입니다

**확인 방법**:
1. **배포가 정상적으로 되었는지 확인**:
   ```bash
   git push cafe24 master
   # Remote: npm install... 메시지가 보이면 정상
   ```

2. **카페24 관리자 페이지에서 앱 상태 확인**:
   - [앱 생성/관리]에서 상태가 **"실행 중(Running)"**이면 정상

3. **SSH로 파일 확인**:
   ```bash
   ls -al
   # 프로젝트 파일들이 보이면 정상
   ```

### 로그 확인

**실시간 로그 확인** (SSH 접속 후):

```bash
# 서버 로그 확인
tail -f logs/web.log

# 또는
tail -f logs/out.log
tail -f logs/error.log
```

**카페24 관리자 페이지에서 로그 확인**:
1. [앱 생성/관리] 메뉴에서 앱 선택
2. 로그 탭 클릭
3. 에러 메시지 확인

### .env 파일이 적용되지 않음

**확인 사항**:
1. WinSCP로 `.env` 파일이 정상적으로 업로드되었는지 확인
2. 파일 위치가 앱 루트 디렉토리인지 확인
3. 앱을 재시작했는지 확인 ([중지] → [실행])

---

## 📝 체크리스트

배포 전 확인 사항:

- [ ] 로컬에서 `npm start`로 정상 작동 확인
- [ ] `web.js` 파일이 프로젝트 루트에 있음
- [ ] 포트가 8001로 설정됨
- [ ] `.gitignore`에 `node_modules/`, `.env` 포함
- [ ] 카페24에 SSH 공개키 등록 및 할당 완료
- [ ] Git 저장소 주소 복사 완료
- [ ] `git push cafe24 master` 성공
- [ ] `.env` 파일 WinSCP로 업로드 완료
- [ ] 카페24 관리자 페이지에서 앱 [실행] 클릭
- [ ] 웹사이트 접속 테스트 완료

---

## 🔄 업데이트 워크플로우

코드를 수정한 후 재배포하는 과정:

```bash
# 1. 코드 수정 후 커밋
git add .
git commit -m "업데이트 내용"

# 2. 카페24 서버로 푸시
git push cafe24 master

# 3. 카페24 관리자 페이지에서
# [중지] 버튼 클릭 → [실행] 버튼 클릭
```

---

## 📞 추가 지원

- **카페24 고객센터**: 1544-0356
- **이메일**: help@cafe24.com
- **카페24 가이드**: https://hosting.cafe24.com/

---

**배포에 성공하셨나요? 축하합니다! 🎉**
